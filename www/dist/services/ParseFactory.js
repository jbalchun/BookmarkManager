var app=angular.module("MyApp.ParseFactory",[]);app.factory("ParseFactory",["$rootScope",function(e){return{register:function(r){console.log("registering");var o=new Parse.User;o.set("username",r.email),o.set("password",r.password),o.set("email",r.email),o.signUp(null,{success:function(o){e.$broadcast("logged-in"),e.email=r.email,e.$storage.username=r.email},error:function(e,r){console.log(r),125==r.code&&alert("Error, invalid email address"),202==r.code?alert("Error, username is taken! Already an account w/ this email"):alert("Error signing up, make sure email is valid")}})},logIn:function(r){e.username=r.email,e.email=r.email,console.log("logging in"),Parse.User.logIn(r.email,r.password,{success:function(o){e.$broadcast("logged-in"),e.$storage.username=r.email},error:function(e,r){return console.log(r),alert("Error: No connection or invalid username/password"),!1}})},saveNew:function(r){var o=JSON.stringify(r),n=Parse.Object.extend("Backup"),s=new n;console.log("backing up",e.username),s.set("username",e.username),s.set("file",o),s.save(null,{success:function(e){console.log("save success")},error:function(e,r){console.log("save err",r)}})},deleteThenSave:function(r){var o=this,n=new Parse.Query("Backup");console.log("deleting"),n.equalTo("username",e.username),n.find({success:function(e){for(var n=0;n<e.length;n++)e[n].destroy({});o.saveNew(r)},error:function(e){console.log("delete err",e)}})},loadFrom:function(e,r){var o=new Parse.Query("Backup");console.log("queryname",e),o.equalTo("username",e),o.find({success:function(e){e[0]&&(console.log("result",e[0].get("file")),console.log("parse",JSON.parse(e[0].get("file"))),r.setModel(JSON.parse(e[0].get("file"))))},error:function(e){}})}}}]);